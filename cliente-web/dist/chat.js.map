{"version":3,"file":"chat.js","mappings":"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","sources":["webpack://cliente-web/./src/modules/webrtc.js","webpack://cliente-web/./src/modules/messages.js","webpack://cliente-web/./src/modules/ui.js","webpack://cliente-web/./src/modules/audio.js","webpack://cliente-web/webpack/bootstrap","webpack://cliente-web/./src/chat.js"],"sourcesContent":["/**\r\n * MÃ³dulo para manejo de llamadas WebRTC\r\n */\r\n\r\nexport class WebRTCHandler {\r\n    constructor(chatApp) {\r\n        this.app = chatApp;\r\n        this.isInCall = false;\r\n        this.localStream = null;\r\n        this.remoteStream = null;\r\n        this.peerConnection = null;\r\n        this.currentCallId = null;\r\n        this.pendingCandidates = [];\r\n        this.callPeer = null;\r\n        this.callTimerInterval = null;\r\n        this.callStartTime = null;\r\n        \r\n        // ConfiguraciÃ³n de servidores ICE (STUN pÃºblicos para NAT traversal)\r\n        this.iceServers = {\r\n            iceServers: [\r\n                { urls: 'stun:stun.l.google.com:19302' },\r\n                { urls: 'stun:stun1.l.google.com:19302' },\r\n                { urls: 'stun:stun2.l.google.com:19302' }\r\n            ]\r\n        };\r\n    }\r\n\r\n    async startCall() {\r\n        console.log('=== startCall (WebRTC) ===');\r\n        console.log('targetUser:', this.app.targetUser);\r\n        console.log('isInCall:', this.isInCall);\r\n        \r\n        if (!this.app.targetUser) {\r\n            alert('âš ï¸ Primero selecciona un usuario o grupo para llamar');\r\n            return;\r\n        }\r\n\r\n        if (this.isInCall) {\r\n            console.log('Terminando llamada...');\r\n            this.endCall();\r\n            return;\r\n        }\r\n\r\n        try {\r\n            this.callPeer = this.app.targetUser;\r\n\r\n            // Obtener audio local\r\n            console.log('Solicitando acceso al micrÃ³fono...');\r\n            this.localStream = await navigator.mediaDevices.getUserMedia({ \r\n                audio: true,\r\n                video: false\r\n            });\r\n            console.log('âœ“ MicrÃ³fono activado');\r\n\r\n            // Crear PeerConnection\r\n            this.createPeerConnection();\r\n\r\n            // AÃ±adir tracks locales al peer connection\r\n            this.localStream.getTracks().forEach(track => {\r\n                this.peerConnection.addTrack(track, this.localStream);\r\n            });\r\n\r\n            // Crear oferta SDP\r\n            const offer = await this.peerConnection.createOffer();\r\n            await this.peerConnection.setLocalDescription(offer);\r\n            console.log('âœ“ Oferta SDP creada');\r\n\r\n            // Enviar oferta via WebSocket\r\n            this.app.ws.send(JSON.stringify({\r\n                type: 'call-offer',\r\n                to: this.app.targetUser,\r\n                offer: offer,\r\n                isGroup: this.app.isGroupChat\r\n            }));\r\n\r\n            console.log('ðŸ“ž Llamando a', this.app.targetUser);\r\n\r\n            // Iniciar UI de llamada (esperando respuesta)\r\n            this.isInCall = true;\r\n            this.updateCallUI(true);\r\n            this.startCallTimer();\r\n            this.showCallIndicator();\r\n\r\n            this.app.ui.displayMessage({\r\n                from: this.app.username,\r\n                to: this.app.targetUser,\r\n                message: 'ðŸ“ž Llamando...',\r\n                type: 'call',\r\n                timestamp: new Date().toISOString()\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error('Error iniciando llamada:', error);\r\n            \r\n            if (error.name === 'NotAllowedError') {\r\n                alert('âŒ Permiso de micrÃ³fono denegado.');\r\n            } else if (error.name === 'NotFoundError') {\r\n                alert('âŒ No se encontrÃ³ micrÃ³fono.');\r\n            } else {\r\n                alert('âŒ Error al iniciar llamada: ' + error.message);\r\n            }\r\n            this.cleanupCall();\r\n        }\r\n    }\r\n\r\n    async handleCallOffer(data) {\r\n        const { from, offer, callId, isGroup } = data;\r\n        console.log(`ðŸ“ž Oferta de llamada recibida de ${from}`);\r\n\r\n        // Si ya estamos en una llamada, rechazar\r\n        if (this.isInCall) {\r\n            this.app.ws.send(JSON.stringify({\r\n                type: 'call-reject',\r\n                to: from,\r\n                callId: callId\r\n            }));\r\n            return;\r\n        }\r\n\r\n        // Mostrar diÃ¡logo de aceptar/rechazar\r\n        const accept = confirm(`ðŸ“ž Llamada entrante de ${from}. Â¿Aceptar?`);\r\n        \r\n        if (!accept) {\r\n            this.app.ws.send(JSON.stringify({\r\n                type: 'call-reject',\r\n                to: from,\r\n                callId: callId\r\n            }));\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Aceptar llamada\r\n            this.callPeer = from;\r\n            this.currentCallId = callId;\r\n            this.app.targetUser = from;\r\n            this.app.isGroupChat = isGroup || false;\r\n            this.app.ui.updateChatInterface();\r\n\r\n            // Obtener audio local\r\n            this.localStream = await navigator.mediaDevices.getUserMedia({ \r\n                audio: true, \r\n                video: false \r\n            });\r\n            console.log('âœ“ MicrÃ³fono activado');\r\n\r\n            // Crear PeerConnection\r\n            this.createPeerConnection();\r\n\r\n            // AÃ±adir tracks locales\r\n            this.localStream.getTracks().forEach(track => {\r\n                this.peerConnection.addTrack(track, this.localStream);\r\n            });\r\n\r\n            // Establecer oferta remota\r\n            await this.peerConnection.setRemoteDescription(new RTCSessionDescription(offer));\r\n            console.log('âœ“ Oferta remota establecida');\r\n\r\n            // AÃ±adir candidatos pendientes\r\n            for (const candidate of this.pendingCandidates) {\r\n                await this.peerConnection.addIceCandidate(new RTCIceCandidate(candidate));\r\n            }\r\n            this.pendingCandidates = [];\r\n\r\n            // Crear respuesta\r\n            const answer = await this.peerConnection.createAnswer();\r\n            await this.peerConnection.setLocalDescription(answer);\r\n            console.log('âœ“ Respuesta SDP creada');\r\n\r\n            // Enviar respuesta\r\n            this.app.ws.send(JSON.stringify({\r\n                type: 'call-answer',\r\n                to: from,\r\n                answer: answer,\r\n                callId: callId\r\n            }));\r\n\r\n            // Iniciar UI de llamada\r\n            this.isInCall = true;\r\n            this.updateCallUI(true);\r\n            this.startCallTimer();\r\n            this.showCallIndicator();\r\n\r\n            this.app.ui.displayMessage({\r\n                from: from,\r\n                to: this.app.username,\r\n                message: 'ðŸ“ž Llamada conectada',\r\n                type: 'call',\r\n                timestamp: new Date().toISOString()\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error('Error aceptando llamada:', error);\r\n            alert('Error al aceptar llamada: ' + error.message);\r\n            this.cleanupCall();\r\n        }\r\n    }\r\n\r\n    async handleCallAnswer(data) {\r\n        const { from, answer } = data;\r\n        console.log(`âœ… Respuesta de llamada recibida de ${from}`);\r\n\r\n        try {\r\n            await this.peerConnection.setRemoteDescription(new RTCSessionDescription(answer));\r\n            console.log('âœ“ Respuesta remota establecida - Llamada conectada!');\r\n\r\n            this.app.ui.displayMessage({\r\n                from: this.app.username,\r\n                to: from,\r\n                message: 'ðŸ“ž Llamada conectada',\r\n                type: 'call',\r\n                timestamp: new Date().toISOString()\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error('Error procesando respuesta:', error);\r\n        }\r\n    }\r\n\r\n    async handleRemoteIceCandidate(data) {\r\n        const { from, candidate } = data;\r\n\r\n        if (!candidate) return;\r\n\r\n        try {\r\n            if (this.peerConnection && this.peerConnection.remoteDescription) {\r\n                await this.peerConnection.addIceCandidate(new RTCIceCandidate(candidate));\r\n                console.log('âœ“ Candidato ICE aÃ±adido');\r\n            } else {\r\n                // Guardar para despuÃ©s\r\n                this.pendingCandidates.push(candidate);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error aÃ±adiendo candidato ICE:', error);\r\n        }\r\n    }\r\n\r\n    handleCallRejected(data) {\r\n        console.log(`âŒ Llamada rechazada por ${data.from}`);\r\n        alert(`${data.from} rechazÃ³ la llamada`);\r\n        this.cleanupCall();\r\n    }\r\n\r\n    handleCallEnded(data) {\r\n        console.log(`ðŸ“´ Llamada terminada por ${data.from}`);\r\n        \r\n        const reason = data.reason === 'user_disconnected' \r\n            ? 'El usuario se desconectÃ³' \r\n            : 'Llamada finalizada';\r\n        \r\n        this.app.ui.displayMessage({\r\n            from: data.from,\r\n            to: this.app.username,\r\n            message: `ðŸ“ž ${reason}`,\r\n            type: 'call',\r\n            timestamp: new Date().toISOString()\r\n        });\r\n\r\n        this.cleanupCall();\r\n    }\r\n\r\n    handleCallFailed(data) {\r\n        console.log(`âŒ Llamada fallida: ${data.reason}`);\r\n        alert(`No se pudo conectar la llamada: ${data.to} no estÃ¡ disponible`);\r\n        this.cleanupCall();\r\n    }\r\n\r\n    createPeerConnection() {\r\n        console.log('Creando RTCPeerConnection...');\r\n        \r\n        this.peerConnection = new RTCPeerConnection(this.iceServers);\r\n\r\n        // Manejar candidatos ICE locales\r\n        this.peerConnection.onicecandidate = (event) => {\r\n            if (event.candidate) {\r\n                console.log('Candidato ICE local generado');\r\n                this.app.ws.send(JSON.stringify({\r\n                    type: 'ice-candidate',\r\n                    to: this.callPeer,\r\n                    candidate: event.candidate\r\n                }));\r\n            }\r\n        };\r\n\r\n        // Manejar cambios de estado de conexiÃ³n\r\n        this.peerConnection.onconnectionstatechange = () => {\r\n            console.log('Estado de conexiÃ³n:', this.peerConnection.connectionState);\r\n            \r\n            if (this.peerConnection.connectionState === 'connected') {\r\n                console.log('ðŸŽ‰ ConexiÃ³n WebRTC establecida!');\r\n            } else if (this.peerConnection.connectionState === 'failed' || \r\n                       this.peerConnection.connectionState === 'disconnected') {\r\n                console.log('ConexiÃ³n perdida');\r\n                this.cleanupCall();\r\n            }\r\n        };\r\n\r\n        // Manejar stream remoto (audio del otro usuario)\r\n        this.peerConnection.ontrack = (event) => {\r\n            console.log('ðŸ”Š Stream remoto recibido!');\r\n            this.remoteStream = event.streams[0];\r\n            \r\n            // Reproducir audio remoto\r\n            let remoteAudio = document.getElementById('remoteAudio');\r\n            if (!remoteAudio) {\r\n                remoteAudio = document.createElement('audio');\r\n                remoteAudio.id = 'remoteAudio';\r\n                remoteAudio.autoplay = true;\r\n                document.body.appendChild(remoteAudio);\r\n            }\r\n            remoteAudio.srcObject = this.remoteStream;\r\n            console.log('âœ“ Audio remoto conectado');\r\n        };\r\n\r\n        console.log('âœ“ RTCPeerConnection creado');\r\n    }\r\n\r\n    showCallIndicator() {\r\n        const callIndicator = document.getElementById('callIndicator');\r\n        if (callIndicator) {\r\n            callIndicator.style.display = 'flex';\r\n        }\r\n    }\r\n\r\n    hideCallIndicator() {\r\n        const callIndicator = document.getElementById('callIndicator');\r\n        if (callIndicator) {\r\n            callIndicator.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    startCallTimer() {\r\n        this.callStartTime = Date.now();\r\n        this.callTimerInterval = setInterval(() => {\r\n            const elapsed = Math.floor((Date.now() - this.callStartTime) / 1000);\r\n            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');\r\n            const seconds = (elapsed % 60).toString().padStart(2, '0');\r\n            const timerEl = document.getElementById('callTimer');\r\n            if (timerEl) {\r\n                timerEl.textContent = `${minutes}:${seconds}`;\r\n            }\r\n        }, 1000);\r\n    }\r\n\r\n    endCall() {\r\n        console.log('=== Terminando llamada WebRTC ===');\r\n        \r\n        // Notificar al otro usuario\r\n        if (this.callPeer && this.app.ws && this.app.ws.readyState === WebSocket.OPEN) {\r\n            this.app.ws.send(JSON.stringify({\r\n                type: 'call-end',\r\n                to: this.callPeer,\r\n                callId: this.currentCallId\r\n            }));\r\n        }\r\n\r\n        // Calcular duraciÃ³n antes de limpiar\r\n        const duration = this.callStartTime \r\n            ? Math.floor((Date.now() - this.callStartTime) / 1000) \r\n            : 0;\r\n        const minutes = Math.floor(duration / 60);\r\n        const seconds = duration % 60;\r\n        const durationStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n\r\n        // Mostrar mensaje de fin de llamada\r\n        if (this.callPeer) {\r\n            this.app.ui.displayMessage({\r\n                from: this.app.username,\r\n                to: this.callPeer,\r\n                message: `ðŸ“ž Llamada finalizada (${durationStr})`,\r\n                type: 'call',\r\n                timestamp: new Date().toISOString()\r\n            });\r\n        }\r\n\r\n        console.log('âœ“ Llamada terminada, duraciÃ³n:', durationStr);\r\n\r\n        this.cleanupCall();\r\n    }\r\n\r\n    cleanupCall() {\r\n        console.log('Limpiando recursos de llamada...');\r\n\r\n        // Cerrar PeerConnection\r\n        if (this.peerConnection) {\r\n            this.peerConnection.close();\r\n            this.peerConnection = null;\r\n        }\r\n\r\n        // Detener stream local\r\n        if (this.localStream) {\r\n            this.localStream.getTracks().forEach(track => {\r\n                track.stop();\r\n                console.log('Track local detenido:', track.kind);\r\n            });\r\n            this.localStream = null;\r\n        }\r\n\r\n        // Detener stream remoto\r\n        if (this.remoteStream) {\r\n            this.remoteStream.getTracks().forEach(track => track.stop());\r\n            this.remoteStream = null;\r\n        }\r\n\r\n        // Limpiar audio remoto\r\n        const remoteAudio = document.getElementById('remoteAudio');\r\n        if (remoteAudio) {\r\n            remoteAudio.srcObject = null;\r\n        }\r\n\r\n        // Ocultar indicador de llamada\r\n        this.hideCallIndicator();\r\n\r\n        // Detener timer\r\n        if (this.callTimerInterval) {\r\n            clearInterval(this.callTimerInterval);\r\n            this.callTimerInterval = null;\r\n        }\r\n\r\n        // Resetear estado\r\n        this.isInCall = false;\r\n        this.callPeer = null;\r\n        this.currentCallId = null;\r\n        this.pendingCandidates = [];\r\n        this.updateCallUI(false);\r\n\r\n        console.log('âœ“ Recursos de llamada limpiados');\r\n    }\r\n\r\n    updateCallUI(inCall) {\r\n        const btn = document.getElementById('callBtn');\r\n        if (btn) {\r\n            if (inCall) {\r\n                btn.classList.add('in-call');\r\n                btn.innerHTML = 'ðŸ“ž Colgar';\r\n            } else {\r\n                btn.classList.remove('in-call');\r\n                btn.innerHTML = 'ðŸ“ž Llamar';\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","/**\r\n * MÃ³dulo para manejo de mensajes\r\n * Incluye envÃ­o, recepciÃ³n y validaciÃ³n de mensajes\r\n */\r\n\r\nexport class MessageHandler {\r\n    constructor(chatApp) {\r\n        this.app = chatApp;\r\n    }\r\n\r\n    async sendMessage() {\r\n        const messageInput = document.getElementById('messageInput');\r\n        const message = messageInput.value.trim();\r\n\r\n        if (message && this.app.targetUser) {\r\n            // Mostrar mensaje inmediatamente (optimistic update)\r\n            const optimisticMessage = {\r\n                from: this.app.username,\r\n                to: this.app.targetUser,\r\n                message: message,\r\n                timestamp: Date.now(),\r\n                isGroup: this.app.isGroupChat,\r\n                type: 'text'\r\n            };\r\n            this.app.ui.displayMessage(optimisticMessage);\r\n            messageInput.value = '';\r\n            \r\n            try {\r\n                console.log(`ðŸ“¤ [Cliente] Enviando mensaje: ${this.app.username} -> ${this.app.targetUser}`);\r\n                const response = await fetch(`${this.app.API_URL}/sendMessage`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({\r\n                        from: this.app.username,\r\n                        to: this.app.targetUser,\r\n                        message: message,\r\n                        isGroup: this.app.isGroupChat\r\n                    })\r\n                });\r\n\r\n                if (!response.ok) {\r\n                    throw new Error(`HTTP error! status: ${response.status}`);\r\n                }\r\n\r\n                const result = await response.json();\r\n                console.log('âœ… Mensaje enviado, respuesta:', result);\r\n                \r\n                // El callback Ice actualizarÃ¡ el mensaje con el timestamp real del servidor\r\n                // displayMessage() ya previene duplicados, asÃ­ que no habrÃ¡ problema\r\n            } catch (error) {\r\n                console.error('âŒ Error enviando mensaje:', error);\r\n                alert('Error al enviar mensaje: ' + error.message);\r\n            }\r\n        }\r\n    }\r\n\r\n    handleNewMessage(message) {\r\n        console.log('ðŸ“¨ [Cliente] Nuevo mensaje recibido:', message);\r\n        console.log('   Usuario actual:', this.app.username);\r\n        console.log('   TargetUser:', this.app.targetUser);\r\n        console.log('   Mensaje from:', message.from, 'to:', message.to, 'isGroup:', message.isGroup);\r\n        \r\n        // Validar que el mensaje tenga los campos necesarios\r\n        if (!message || !message.from || !message.to) {\r\n            console.error('âš ï¸  Mensaje invÃ¡lido recibido:', message);\r\n            return;\r\n        }\r\n        \r\n        // Normalizar valores para comparaciÃ³n\r\n        const msgFrom = String(message.from || '').trim();\r\n        const msgTo = String(message.to || '').trim();\r\n        const targetUser = String(this.app.targetUser || '').trim();\r\n        const username = String(this.app.username || '').trim();\r\n        const isGroup = message.isGroup || false;\r\n        \r\n        // Verificar si el mensaje es relevante para el chat actual\r\n        let isRelevant = false;\r\n        \r\n        if (!targetUser || targetUser === '') {\r\n            // Sin chat abierto: mostrar si es para el usuario actual\r\n            isRelevant = (msgTo === username || msgFrom === username);\r\n        } else if (isGroup) {\r\n            // Chat de grupo: mostrar si es del grupo abierto\r\n            isRelevant = (msgTo === targetUser);\r\n        } else {\r\n            // Chat directo: mostrar si involucra al usuario actual Y al targetUser\r\n            // Caso 1: Mensaje viene del targetUser y va al usuario actual (recibiendo mensaje)\r\n            // Caso 2: Mensaje viene del usuario actual y va al targetUser (enviando mensaje)\r\n            const isFromTargetToMe = (msgFrom === targetUser && msgTo === username);\r\n            const isFromMeToTarget = (msgFrom === username && msgTo === targetUser);\r\n            \r\n            // VerificaciÃ³n adicional: si el mensaje involucra a ambos usuarios\r\n            const involvesMe = (msgFrom === username || msgTo === username);\r\n            const involvesTarget = (msgFrom === targetUser || msgTo === targetUser);\r\n            \r\n            isRelevant = isFromTargetToMe || isFromMeToTarget || (involvesMe && involvesTarget);\r\n        }\r\n        \r\n        console.log('   Â¿Es relevante para el chat actual?', isRelevant);\r\n        console.log('   ComparaciÃ³n:', {\r\n            msgFrom, msgTo, targetUser, username, isGroup,\r\n            isFromTargetToMe: targetUser && !isGroup ? (msgFrom === targetUser && msgTo === username) : 'N/A',\r\n            isFromMeToTarget: targetUser && !isGroup ? (msgFrom === username && msgTo === targetUser) : 'N/A',\r\n            involvesMe: targetUser ? (msgFrom === username || msgTo === username) : 'N/A',\r\n            involvesTarget: targetUser ? (msgFrom === targetUser || msgTo === targetUser) : 'N/A'\r\n        });\r\n        \r\n        if (isRelevant) {\r\n            console.log('   âœ… Mostrando mensaje en el chat');\r\n            this.app.ui.displayMessage(message);\r\n        } else {\r\n            console.log('   âš ï¸  Mensaje no es relevante para el chat actual');\r\n            console.log('   Valores exactos:', {\r\n                msgFrom: `\"${msgFrom}\"`,\r\n                msgTo: `\"${msgTo}\"`,\r\n                targetUser: `\"${targetUser}\"`,\r\n                username: `\"${username}\"`,\r\n                msgFromLength: msgFrom.length,\r\n                targetUserLength: targetUser.length,\r\n                usernameLength: username.length\r\n            });\r\n            \r\n            // Si el mensaje es para el usuario actual pero no tiene el chat abierto,\r\n            // aÃºn asÃ­ mostrar notificaciÃ³n\r\n            if (msgTo === username && msgFrom !== username) {\r\n                console.log('   ðŸ“¬ Mensaje recibido pero chat no abierto - mostrando notificaciÃ³n');\r\n            }\r\n        }\r\n        \r\n        // Mostrar notificaciÃ³n si el mensaje no es del usuario actual\r\n        if (msgFrom !== username) {\r\n            this.showNotification(message);\r\n        }\r\n    }\r\n\r\n\r\n    showNotification(message) {\r\n        // NotificaciÃ³n en el tÃ­tulo de la pÃ¡gina\r\n        if (document.hidden) {\r\n            document.title = `ðŸ’¬ Nuevo mensaje de ${message.from}`;\r\n            setTimeout(() => {\r\n                document.title = 'Chat App';\r\n            }, 3000);\r\n        }\r\n    }\r\n\r\n    async loadHistory(target) {\r\n        try {\r\n            const response = await fetch(`${this.app.API_URL}/getHistory`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    target,\r\n                    from: this.app.username,\r\n                    isGroup: this.app.isGroupChat\r\n                })\r\n            });\r\n            const result = await response.json();\r\n            \r\n            // Parsear mensajes si vienen como strings JSON\r\n            let messages = [];\r\n            if (result.messages && Array.isArray(result.messages)) {\r\n                messages = result.messages.map(m => {\r\n                    if (typeof m === 'string') {\r\n                        try {\r\n                            return JSON.parse(m);\r\n                        } catch (e) {\r\n                            return null;\r\n                        }\r\n                    }\r\n                    return m;\r\n                }).filter(m => m !== null);\r\n            }\r\n            \r\n            this.app.ui.displayHistory(messages);\r\n        } catch (error) {\r\n            console.error('Error cargando historial:', error);\r\n        }\r\n    }\r\n}\r\n\r\n","/**\r\n * MÃ³dulo para manipulaciÃ³n del DOM y UI\r\n */\r\n\r\nexport class UIHandler {\r\n    constructor(chatApp) {\r\n        this.app = chatApp;\r\n        this.colors = [\r\n            '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',\r\n            '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'\r\n        ];\r\n    }\r\n\r\n    displayMessage(msg) {\r\n        const container = document.getElementById('messagesContainer');\r\n        if (!container) {\r\n            console.warn('âš ï¸  No se encontrÃ³ el contenedor de mensajes');\r\n            return;\r\n        }\r\n        \r\n        // Evitar duplicados - verificar los Ãºltimos 20 mensajes\r\n        const existingMsgs = container.querySelectorAll('.message');\r\n        const msgContent = String(msg.message || msg.content || '').trim();\r\n        const msgTimestamp = msg.timestamp ? (typeof msg.timestamp === 'string' ? parseInt(msg.timestamp) : msg.timestamp) : Date.now();\r\n        const msgFrom = String(msg.from || '').trim();\r\n        \r\n        // Solo verificar duplicados si el mensaje viene del mismo usuario\r\n        // Esto evita que se filtren mensajes vÃ¡lidos de diferentes usuarios\r\n        if (msgFrom) {\r\n            for (let i = existingMsgs.length - 1; i >= Math.max(0, existingMsgs.length - 20); i--) {\r\n                const existing = existingMsgs[i];\r\n                const existingFrom = String(existing.dataset.from || '').trim();\r\n                const existingMsg = String(existing.dataset.message || '').trim();\r\n                const existingTime = existing.dataset.timestamp ? parseInt(existing.dataset.timestamp) : 0;\r\n                \r\n                // Verificar si es el mismo mensaje (mismo remitente, contenido idÃ©ntico y timestamp muy similar)\r\n                // Usar una ventana de tiempo mÃ¡s estricta (2 segundos) para evitar falsos positivos\r\n                // IMPORTANTE: Solo considerar duplicado si viene del MISMO usuario Y el contenido es idÃ©ntico\r\n                if (existingFrom === msgFrom && \r\n                    existingMsg === msgContent &&\r\n                    msgContent.length > 0 && // Solo verificar si hay contenido\r\n                    Math.abs(existingTime - msgTimestamp) < 2000) {\r\n                    console.log('âš ï¸  Mensaje duplicado detectado, ignorando');\r\n                    console.log(`   Existente: from=${existingFrom}, msg=\"${existingMsg.substring(0, 30)}...\", time=${existingTime}`);\r\n                    console.log(`   Nuevo: from=${msgFrom}, msg=\"${msgContent.substring(0, 30)}...\", time=${msgTimestamp}`);\r\n                    return; // Ya existe\r\n                }\r\n            }\r\n        }\r\n        \r\n        console.log('âœ… Agregando nuevo mensaje al chat:', msgFrom, '->', msg.to);\r\n        const messageEl = this.createMessageElement(msg);\r\n        container.appendChild(messageEl);\r\n        container.scrollTop = container.scrollHeight;\r\n    }\r\n\r\n    displayHistory(messages) {\r\n        const container = document.getElementById('messagesContainer');\r\n        if (!container) return;\r\n        \r\n        container.innerHTML = '';\r\n        if (Array.isArray(messages) && messages.length > 0) {\r\n            messages.forEach(m => {\r\n                try {\r\n                    let msgData = typeof m === 'string' ? JSON.parse(m) : m;\r\n                    if (msgData && msgData.from) {\r\n                        container.appendChild(this.createMessageElement(msgData));\r\n                    }\r\n                } catch (e) {\r\n                    console.error('Error parseando mensaje:', e, m);\r\n                }\r\n            });\r\n        }\r\n        container.scrollTop = container.scrollHeight;\r\n    }\r\n\r\n    createMessageElement(m) {\r\n        const own = m.from === this.app.username;\r\n        const div = document.createElement('div');\r\n        div.className = `message ${own ? 'right' : 'left'}`;\r\n        div.dataset.from = m.from;\r\n        div.dataset.message = m.message || m.content || '';\r\n        // Guardar timestamp para detecciÃ³n de duplicados\r\n        const msgTimestamp = m.timestamp ? (typeof m.timestamp === 'string' ? parseInt(m.timestamp) : m.timestamp) : Date.now();\r\n        div.dataset.timestamp = msgTimestamp.toString();\r\n        \r\n        let content = '';\r\n        if (m.type === 'audio' && m.audioData) {\r\n            // Determinar si audioData ya incluye el prefijo o es solo Base64\r\n            let audioSrc = m.audioData;\r\n            if (!audioSrc.startsWith('data:')) {\r\n                audioSrc = `data:audio/webm;base64,${audioSrc}`;\r\n            }\r\n            content = `\r\n                <div class=\"audio-message\">\r\n                    <span class=\"audio-icon\">ðŸŽµ</span>\r\n                    <audio controls>\r\n                        <source src=\"${audioSrc}\" type=\"audio/webm\">\r\n                        Tu navegador no soporta audio.\r\n                    </audio>\r\n                </div>\r\n            `;\r\n        } else if (m.type === 'call') {\r\n            content = `<div class=\"call-message\">ðŸ“ž ${this.escapeHtml(m.message || m.content)}</div>`;\r\n        } else {\r\n            content = `<div class=\"text\">${this.escapeHtml(m.message || m.content)}</div>`;\r\n        }\r\n        \r\n        // Convertir timestamp a fecha legible\r\n        let timestamp;\r\n        if (m.timestamp) {\r\n            if (typeof m.timestamp === 'string') {\r\n                timestamp = new Date(parseInt(m.timestamp)).toLocaleTimeString();\r\n            } else {\r\n                timestamp = new Date(m.timestamp).toLocaleTimeString();\r\n            }\r\n        } else {\r\n            timestamp = new Date().toLocaleTimeString();\r\n        }\r\n        \r\n        div.innerHTML = `\r\n            <div class=\"avatar\" style=\"background-color:${this.getAvatarColor(m.from)}\">\r\n                ${m.from[0].toUpperCase()}\r\n            </div>\r\n            <div class=\"text-wrapper\">\r\n                ${!own ? `<div class=\"user-name\">${this.escapeHtml(m.from)}</div>` : ''}\r\n                ${content}\r\n                <div class=\"timestamp\">${timestamp}</div>\r\n            </div>`;\r\n        return div;\r\n    }\r\n\r\n    updateChatInterface() {\r\n        document.getElementById('chatTarget').textContent = this.app.targetUser;\r\n        document.getElementById('groupBadge').style.display = this.app.isGroupChat ? 'inline-block' : 'none';\r\n\r\n        const inputWrapper = document.getElementById('messageInputWrapper');\r\n        if (this.app.targetUser) {\r\n            inputWrapper.style.display = 'flex';\r\n        } else {\r\n            inputWrapper.style.display = 'none';\r\n        }\r\n        \r\n        // Actualizar listas para marcar el seleccionado\r\n        this.app.loadUsers();\r\n        this.app.loadGroups();\r\n    }\r\n\r\n    updateUserList(users) {\r\n        const usersList = document.getElementById('usersList');\r\n        usersList.innerHTML = '';\r\n        if (!users || users.length === 0) {\r\n            usersList.innerHTML = '<p style=\"color:#95a5a6;font-size:12px;padding:10px;\">No hay usuarios</p>';\r\n            return;\r\n        }\r\n        users.forEach(user => {\r\n            const el = document.createElement('div');\r\n            el.className = 'user-item';\r\n            if (user === this.app.targetUser && !this.app.isGroupChat) {\r\n                el.classList.add('active');\r\n            }\r\n            el.innerHTML = `<div class=\"avatar\" style=\"background-color:${this.getAvatarColor(user)}\">${user[0].toUpperCase()}</div><span>${user}</span>`;\r\n            el.onclick = () => this.app.selectUser(user);\r\n            usersList.appendChild(el);\r\n        });\r\n    }\r\n\r\n    updateGroupList(groups) {\r\n        const groupsList = document.getElementById('groupsList');\r\n        groupsList.innerHTML = '';\r\n        if (!groups || groups.length === 0) {\r\n            groupsList.innerHTML = '<p style=\"color:#95a5a6;font-size:12px;padding:10px;\">No hay grupos</p>';\r\n            return;\r\n        }\r\n        groups.forEach(group => {\r\n            const el = this.createGroupElement(group);\r\n            groupsList.appendChild(el);\r\n        });\r\n    }\r\n\r\n    addGroupToList(groupName) {\r\n        const groupsList = document.getElementById('groupsList');\r\n        if (!groupsList) return;\r\n        \r\n        // Verificar si ya existe\r\n        const existing = Array.from(groupsList.children).find(\r\n            el => {\r\n                const span = el.querySelector('span');\r\n                return span && span.textContent.trim() === groupName;\r\n            }\r\n        );\r\n        if (existing) return;\r\n        \r\n        // Remover mensaje \"No hay grupos\" si existe\r\n        const noGroupsMsg = groupsList.querySelector('p');\r\n        if (noGroupsMsg) {\r\n            noGroupsMsg.remove();\r\n        }\r\n        \r\n        const el = this.createGroupElement(groupName);\r\n        groupsList.appendChild(el);\r\n    }\r\n\r\n    removeGroupFromList(groupName) {\r\n        const groupsList = document.getElementById('groupsList');\r\n        if (!groupsList) return;\r\n        \r\n        const groupEl = Array.from(groupsList.children).find(\r\n            el => {\r\n                const span = el.querySelector('span');\r\n                return span && span.textContent.trim() === groupName;\r\n            }\r\n        );\r\n        \r\n        if (groupEl) {\r\n            groupEl.remove();\r\n        }\r\n        \r\n        // Si no quedan grupos, mostrar mensaje\r\n        if (groupsList.children.length === 0) {\r\n            groupsList.innerHTML = '<p style=\"color:#95a5a6;font-size:12px;padding:10px;\">No hay grupos</p>';\r\n        }\r\n    }\r\n\r\n    createGroupElement(group) {\r\n        const el = document.createElement('div');\r\n        el.className = 'group-item';\r\n        if (group === this.app.targetUser && this.app.isGroupChat) {\r\n            el.classList.add('active');\r\n        }\r\n        el.innerHTML = `<div class=\"group-avatar\">#</div><span>${group}</span>`;\r\n        el.onclick = () => this.app.selectGroup(group);\r\n        return el;\r\n    }\r\n\r\n    updateConnectionStatus(connected) {\r\n        const statusEl = document.getElementById('connectionStatus');\r\n        if (statusEl) {\r\n            statusEl.className = connected ? 'status-connected' : 'status-disconnected';\r\n            statusEl.textContent = connected ? 'â— Conectado' : 'â—‹ Desconectado';\r\n        }\r\n    }\r\n\r\n    getAvatarColor(u) {\r\n        return this.colors[u.charCodeAt(0) % this.colors.length];\r\n    }\r\n\r\n    escapeHtml(t) {\r\n        if (!t) return '';\r\n        const div = document.createElement('div');\r\n        div.textContent = t;\r\n        return div.innerHTML;\r\n    }\r\n}\r\n\r\n","/**\r\n * MÃ³dulo para grabaciÃ³n y envÃ­o de notas de voz\r\n */\r\n\r\nexport class AudioHandler {\r\n    constructor(chatApp) {\r\n        this.app = chatApp;\r\n        this.isRecording = false;\r\n        this.mediaRecorder = null;\r\n        this.audioChunks = [];\r\n        this.currentAudioStream = null;\r\n    }\r\n\r\n    async sendVoiceNote() {\r\n        if (!this.app.targetUser) {\r\n            alert('Selecciona un destinatario primero');\r\n            return;\r\n        }\r\n\r\n        console.log('Iniciando grabaciÃ³n de voz...');\r\n\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n            console.log('MicrÃ³fono accedido correctamente');\r\n            \r\n            // Detectar el mejor mimeType soportado\r\n            let mimeType = 'audio/webm';\r\n            if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n                mimeType = 'audio/ogg';\r\n                if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n                    mimeType = 'audio/mp4';\r\n                    if (!MediaRecorder.isTypeSupported(mimeType)) {\r\n                        mimeType = ''; // Usar el default del navegador\r\n                    }\r\n                }\r\n            }\r\n            console.log('Usando mimeType:', mimeType || 'default');\r\n            \r\n            const options = mimeType ? { mimeType } : {};\r\n            this.mediaRecorder = new MediaRecorder(stream, options);\r\n            this.audioChunks = [];\r\n            this.currentAudioStream = stream; // Guardar referencia al stream\r\n\r\n            this.mediaRecorder.ondataavailable = (event) => {\r\n                if (event.data.size > 0) {\r\n                    this.audioChunks.push(event.data);\r\n                }\r\n            };\r\n\r\n            this.mediaRecorder.onstop = async () => {\r\n                console.log('GrabaciÃ³n detenida, procesando audio...');\r\n                const audioBlob = new Blob(this.audioChunks, { type: mimeType || 'audio/webm' });\r\n                console.log('Audio blob creado, tamaÃ±o:', audioBlob.size);\r\n                \r\n                // Convertir a Base64\r\n                const reader = new FileReader();\r\n                reader.onloadend = async () => {\r\n                    const base64Audio = reader.result.split(',')[1];\r\n                    console.log('Audio convertido a Base64, longitud:', base64Audio?.length);\r\n                    \r\n                    // Mostrar nota de voz inmediatamente (optimistic update)\r\n                    const audioSrc = `data:${mimeType || 'audio/webm'};base64,${base64Audio}`;\r\n                    const optimisticMessage = {\r\n                        from: this.app.username,\r\n                        to: this.app.targetUser,\r\n                        message: '[Nota de voz]',\r\n                        timestamp: Date.now(),\r\n                        isGroup: this.app.isGroupChat,\r\n                        type: 'audio',\r\n                        audioData: audioSrc\r\n                    };\r\n                    this.app.ui.displayMessage(optimisticMessage);\r\n                    \r\n                    try {\r\n                        const response = await fetch(`${this.app.API_URL}/sendVoiceNote`, {\r\n                            method: 'POST',\r\n                            headers: { 'Content-Type': 'application/json' },\r\n                            body: JSON.stringify({\r\n                                from: this.app.username,\r\n                                to: this.app.targetUser,\r\n                                audioData: base64Audio,\r\n                                isGroup: this.app.isGroupChat\r\n                            })\r\n                        });\r\n                        console.log('Nota de voz enviada, respuesta:', response.status);\r\n                        // El callback Ice actualizarÃ¡ el mensaje con el timestamp real del servidor\r\n                    } catch (error) {\r\n                        console.error('Error enviando nota de voz:', error);\r\n                        alert('Error al enviar nota de voz');\r\n                    }\r\n                };\r\n                reader.readAsDataURL(audioBlob);\r\n\r\n                // Detener el stream\r\n                if (this.currentAudioStream) {\r\n                    this.currentAudioStream.getTracks().forEach(track => track.stop());\r\n                    this.currentAudioStream = null;\r\n                }\r\n            };\r\n\r\n            this.mediaRecorder.start();\r\n            this.isRecording = true;\r\n            this.updateRecordingUI(true);\r\n\r\n            // Detener despuÃ©s de 60 segundos mÃ¡ximo\r\n            setTimeout(() => {\r\n                if (this.isRecording) {\r\n                    this.stopRecording();\r\n                }\r\n            }, 60000);\r\n\r\n        } catch (error) {\r\n            console.error('Error accediendo al micrÃ³fono:', error);\r\n            alert('Error al acceder al micrÃ³fono. AsegÃºrate de dar permisos.');\r\n        }\r\n    }\r\n\r\n    stopRecording() {\r\n        if (this.mediaRecorder && this.isRecording) {\r\n            this.mediaRecorder.stop();\r\n            this.isRecording = false;\r\n            this.updateRecordingUI(false);\r\n        }\r\n    }\r\n\r\n    updateRecordingUI(recording) {\r\n        const btn = document.getElementById('voiceNoteBtn');\r\n        if (btn) {\r\n            if (recording) {\r\n                btn.classList.add('recording');\r\n                btn.innerHTML = 'â¹ Detener';\r\n            } else {\r\n                btn.classList.remove('recording');\r\n                btn.innerHTML = 'ðŸŽ¤ Voz';\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { MessageHandler } from './modules/messages.js';\r\nimport { AudioHandler } from './modules/audio.js';\r\nimport { WebRTCHandler } from './modules/webrtc.js';\r\nimport { UIHandler } from './modules/ui.js';\r\n\r\nclass ChatApp {\r\n    constructor() {\r\n        this.username = '';\r\n        this.targetUser = '';\r\n        this.isGroupChat = false;\r\n        this.API_URL = 'http://localhost:3000';\r\n        this.WS_URL = 'ws://localhost:3000';\r\n        this.ws = null;\r\n        this.reconnectAttempts = 0;\r\n        this.maxReconnectAttempts = 5;\r\n\r\n        // Inicializar mÃ³dulos\r\n        this.ui = new UIHandler(this);\r\n        this.messages = new MessageHandler(this);\r\n        this.audio = new AudioHandler(this);\r\n        this.webrtc = new WebRTCHandler(this);\r\n\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        this.getUsername();\r\n        this.setupEventListeners();\r\n    }\r\n\r\n    getUsername() {\r\n        this.username = prompt('Ingresa tu nombre:') || 'Usuario' + Math.floor(Math.random() * 1000);\r\n        document.getElementById('usernameDisplay').textContent = this.username;\r\n        document.getElementById('userAvatar').textContent = this.username[0].toUpperCase();\r\n        document.getElementById('userAvatar').style.backgroundColor = this.ui.getAvatarColor(this.username);\r\n        this.registerUser();\r\n        this.refreshLists();\r\n        this.connectWebSocket();\r\n    }\r\n\r\n    async registerUser() {\r\n        try {\r\n            const response = await fetch(`${this.API_URL}/register`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ username: this.username })\r\n            });\r\n            const result = await response.json();\r\n            console.log('Usuario registrado:', result);\r\n        } catch (err) {\r\n            console.error('Error registrando usuario', err);\r\n        }\r\n    }\r\n\r\n    // ConexiÃ³n WebSocket para mensajes en tiempo real\r\n    connectWebSocket() {\r\n        try {\r\n            this.ws = new WebSocket(this.WS_URL);\r\n\r\n            this.ws.onopen = () => {\r\n                console.log('WebSocket conectado');\r\n                this.reconnectAttempts = 0;\r\n                \r\n                // Registrar usuario en el WebSocket\r\n                this.ws.send(JSON.stringify({\r\n                    type: 'register',\r\n                    username: this.username\r\n                }));\r\n                \r\n                this.ui.updateConnectionStatus(true);\r\n            };\r\n\r\n            this.ws.onmessage = (event) => {\r\n                try {\r\n                    const data = JSON.parse(event.data);\r\n                    console.log('ðŸ“¥ [WebSocket] Mensaje recibido:', data.type);\r\n                    this.handleWebSocketMessage(data);\r\n                } catch (e) {\r\n                    console.error('âŒ Error parseando mensaje WebSocket:', e);\r\n                    console.error('   Datos recibidos:', event.data);\r\n                }\r\n            };\r\n\r\n            this.ws.onclose = () => {\r\n                console.log('WebSocket desconectado');\r\n                this.ui.updateConnectionStatus(false);\r\n                this.attemptReconnect();\r\n            };\r\n\r\n            this.ws.onerror = (error) => {\r\n                console.error('Error WebSocket:', error);\r\n                this.ui.updateConnectionStatus(false);\r\n            };\r\n\r\n        } catch (error) {\r\n            console.error('Error conectando WebSocket:', error);\r\n            this.attemptReconnect();\r\n        }\r\n    }\r\n\r\n    attemptReconnect() {\r\n        if (this.reconnectAttempts < this.maxReconnectAttempts) {\r\n            this.reconnectAttempts++;\r\n            console.log(`Intentando reconexiÃ³n ${this.reconnectAttempts}/${this.maxReconnectAttempts}...`);\r\n            setTimeout(() => this.connectWebSocket(), 2000 * this.reconnectAttempts);\r\n        } else {\r\n            console.log('MÃ¡ximo de intentos de reconexiÃ³n alcanzado');\r\n        }\r\n    }\r\n\r\n    handleWebSocketMessage(data) {\r\n        console.log('Mensaje WebSocket recibido:', data);\r\n\r\n        switch (data.type) {\r\n            case 'registered':\r\n                console.log('Registrado en WebSocket como:', data.username);\r\n                break;\r\n\r\n            case 'newMessage':\r\n                this.messages.handleNewMessage(data.message);\r\n                break;\r\n\r\n            case 'groupCreated':\r\n                console.log('Nuevo grupo creado:', data.groupName);\r\n                this.loadGroups();\r\n                break;\r\n\r\n            case 'userRegistered':\r\n                console.log('Nuevo usuario registrado:', data.username);\r\n                // Actualizar lista de usuarios cuando alguien nuevo se conecta\r\n                this.loadUsers();\r\n                break;\r\n\r\n            case 'userDisconnected':\r\n                console.log('Usuario desconectado:', data.username);\r\n                // Actualizar lista de usuarios cuando alguien se desconecta\r\n                this.loadUsers();\r\n                break;\r\n\r\n            case 'incomingCall':\r\n                // Legacy - no se usa\r\n                console.log('handleIncomingCall (legacy):', data);\r\n                break;\r\n\r\n            // === WebRTC Signaling ===\r\n            case 'call-offer':\r\n                this.webrtc.handleCallOffer(data);\r\n                break;\r\n\r\n            case 'call-answer':\r\n                this.webrtc.handleCallAnswer(data);\r\n                break;\r\n\r\n            case 'ice-candidate':\r\n                this.webrtc.handleRemoteIceCandidate(data);\r\n                break;\r\n\r\n            case 'call-rejected':\r\n                this.webrtc.handleCallRejected(data);\r\n                break;\r\n\r\n            case 'call-ended':\r\n                this.webrtc.handleCallEnded(data);\r\n                break;\r\n\r\n            case 'call-failed':\r\n                this.webrtc.handleCallFailed(data);\r\n                break;\r\n\r\n            default:\r\n                console.log('Tipo de mensaje no reconocido:', data.type);\r\n        }\r\n    }\r\n\r\n    // MÃ©todos delegados a mÃ³dulos\r\n    async sendMessage() {\r\n        return this.messages.sendMessage();\r\n    }\r\n\r\n    async sendVoiceNote() {\r\n        return this.audio.sendVoiceNote();\r\n    }\r\n\r\n    stopRecording() {\r\n        return this.audio.stopRecording();\r\n    }\r\n\r\n    async startCall() {\r\n        return this.webrtc.startCall();\r\n    }\r\n\r\n    endCall() {\r\n        return this.webrtc.endCall();\r\n    }\r\n\r\n    async createGroup() {\r\n        const groupInput = document.getElementById('newGroupName');\r\n        const groupName = groupInput.value.trim();\r\n        \r\n        console.log('createGroup interno llamado, nombre:', groupName);\r\n\r\n        if (groupName) {\r\n            // Agregar grupo inmediatamente a la lista (optimistic update)\r\n            this.ui.addGroupToList(groupName);\r\n            groupInput.value = '';\r\n            \r\n            try {\r\n                const response = await fetch(`${this.API_URL}/createGroup`, {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ groupName })\r\n                });\r\n                const result = await response.json();\r\n                console.log('Grupo creado, respuesta:', result);\r\n                // El callback 'groupCreated' actualizarÃ¡ la lista si es necesario\r\n            } catch (error) {\r\n                console.error('Error creando grupo:', error);\r\n                alert('Error al crear grupo: ' + error.message);\r\n                // Remover el grupo de la lista si falla\r\n                this.ui.removeGroupFromList(groupName);\r\n            }\r\n        } else {\r\n            alert('Por favor ingresa un nombre para el grupo');\r\n        }\r\n    }\r\n\r\n    selectUser(user) {\r\n        if (user === this.username) return;\r\n        this.targetUser = user;\r\n        this.isGroupChat = false;\r\n        this.ui.updateChatInterface();\r\n        this.messages.loadHistory(user);\r\n    }\r\n\r\n    selectGroup(group) {\r\n        this.targetUser = group;\r\n        this.isGroupChat = true;\r\n        this.ui.updateChatInterface();\r\n        this.messages.loadHistory(group);\r\n    }\r\n\r\n    async loadHistory(target) {\r\n        return this.messages.loadHistory(target);\r\n    }\r\n\r\n    async refreshLists() {\r\n        await this.loadGroups();\r\n        await this.loadUsers();\r\n    }\r\n\r\n    async loadGroups() {\r\n        try {\r\n            const response = await fetch(`${this.API_URL}/getGroups`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({})\r\n            });\r\n            const result = await response.json();\r\n            let groups = [];\r\n            if (result && result.groups) {\r\n                groups = result.groups;\r\n            } else if (result && Array.isArray(result)) {\r\n                groups = result;\r\n            }\r\n            this.ui.updateGroupList(groups);\r\n        } catch (error) {\r\n            console.error('Error cargando grupos:', error);\r\n        }\r\n    }\r\n\r\n    async loadUsers() {\r\n        try {\r\n            const response = await fetch(`${this.API_URL}/getUsers`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({})\r\n            });\r\n            const result = await response.json();\r\n            let users = [];\r\n            if (result && result.users) {\r\n                users = result.users;\r\n            } else if (result && Array.isArray(result)) {\r\n                users = result;\r\n            }\r\n            // Filtrar el usuario actual\r\n            users = users.filter(user => user !== this.username);\r\n            this.ui.updateUserList(users);\r\n        } catch (error) {\r\n            console.error('Error cargando usuarios:', error);\r\n        }\r\n    }\r\n\r\n    setupEventListeners() {\r\n        document.getElementById('messageInput').addEventListener('keypress', e => {\r\n            if (e.key === 'Enter') this.sendMessage();\r\n        });\r\n        \r\n        // Actualizar lista de usuarios periÃ³dicamente (cada 10 segundos)\r\n        setInterval(() => {\r\n            this.loadUsers();\r\n        }, 10000);\r\n    }\r\n\r\n    // Getters para compatibilidad con mÃ³dulos\r\n    get isRecording() {\r\n        return this.audio.isRecording;\r\n    }\r\n\r\n    get isInCall() {\r\n        return this.webrtc.isInCall;\r\n    }\r\n}\r\n\r\n// Inicializar la aplicaciÃ³n y exponer funciones globalmente\r\nlet chatApp;\r\n\r\nwindow.onload = () => { \r\n    chatApp = new ChatApp(); \r\n};\r\n\r\n// Exponer funciones al objeto window para que sean accesibles desde el HTML\r\nwindow.sendMessage = function() { \r\n    console.log('sendMessage llamado');\r\n    if (chatApp) chatApp.sendMessage(); \r\n    else console.error('chatApp no inicializado');\r\n};\r\n\r\nwindow.createGroup = function() { \r\n    console.log('createGroup llamado');\r\n    if (chatApp) chatApp.createGroup();\r\n    else console.error('chatApp no inicializado');\r\n};\r\n\r\nwindow.sendVoiceNote = function() { \r\n    console.log('sendVoiceNote llamado, isRecording:', chatApp?.isRecording);\r\n    if (!chatApp) {\r\n        console.error('chatApp no inicializado');\r\n        return;\r\n    }\r\n    if (chatApp.isRecording) {\r\n        chatApp.stopRecording();\r\n    } else {\r\n        chatApp.sendVoiceNote();\r\n    }\r\n};\r\n\r\nwindow.startCall = function() { \r\n    console.log('startCall llamado');\r\n    if (chatApp) {\r\n        if (chatApp.isInCall) {\r\n            chatApp.endCall();\r\n        } else {\r\n            chatApp.startCall();\r\n        }\r\n    } else {\r\n        console.error('chatApp no inicializado');\r\n    }\r\n};\r\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_defineProperties","_toPropertyKey","key","_typeof","toPrimitive","String","_toPrimitive","exports","WebRTCHandler","chatApp","_classCallCheck","this","app","isInCall","localStream","remoteStream","peerConnection","currentCallId","pendingCandidates","callPeer","callTimerInterval","callStartTime","iceServers","urls","_startCall","_callee","offer","_t","_this","_context","console","log","targetUser","alert","endCall","navigator","mediaDevices","getUserMedia","audio","video","createPeerConnection","getTracks","forEach","track","addTrack","createOffer","setLocalDescription","ws","send","JSON","stringify","type","to","isGroup","isGroupChat","updateCallUI","startCallTimer","showCallIndicator","ui","displayMessage","from","username","message","timestamp","Date","toISOString","error","name","cleanupCall","_handleCallOffer","_callee2","data","callId","_iterator","_step","candidate","answer","_t2","_t3","_this2","_context2","concat","confirm","updateChatInterface","setRemoteDescription","RTCSessionDescription","_createForOfIteratorHelper","s","addIceCandidate","RTCIceCandidate","createAnswer","_x","_handleCallAnswer","_callee3","_t4","_context3","_x2","_handleRemoteIceCandidate","_callee4","_t5","_context4","remoteDescription","push","_x3","reason","_this3","RTCPeerConnection","onicecandidate","event","onconnectionstatechange","connectionState","ontrack","streams","remoteAudio","document","getElementById","createElement","id","autoplay","body","appendChild","srcObject","callIndicator","style","display","_this4","now","setInterval","elapsed","Math","floor","minutes","toString","padStart","seconds","timerEl","textContent","readyState","WebSocket","OPEN","duration","durationStr","close","stop","kind","hideCallIndicator","clearInterval","inCall","btn","classList","add","innerHTML","remove","MessageHandler","_sendMessage","messageInput","optimisticMessage","response","result","trim","fetch","API_URL","method","headers","ok","Error","status","json","isRelevant","msgFrom","msgTo","isFromTargetToMe","isFromMeToTarget","involvesMe","involvesTarget","msgFromLength","targetUserLength","usernameLength","showNotification","hidden","title","setTimeout","_loadHistory","target","messages","Array","isArray","map","parse","filter","displayHistory","UIHandler","colors","msg","container","existingMsgs","querySelectorAll","msgContent","content","msgTimestamp","parseInt","max","existing","existingFrom","dataset","existingMsg","existingTime","abs","substring","messageEl","createMessageElement","scrollTop","scrollHeight","warn","msgData","own","div","className","audioData","audioSrc","startsWith","escapeHtml","toLocaleTimeString","getAvatarColor","toUpperCase","inputWrapper","loadUsers","loadGroups","users","usersList","user","el","onclick","selectUser","groups","groupsList","group","createGroupElement","groupName","children","find","span","querySelector","noGroupsMsg","groupEl","selectGroup","connected","statusEl","charCodeAt","AudioHandler","isRecording","mediaRecorder","audioChunks","currentAudioStream","_sendVoiceNote","stream","mimeType","options","MediaRecorder","isTypeSupported","ondataavailable","size","onstop","audioBlob","reader","Blob","FileReader","onloadend","base64Audio","split","readAsDataURL","start","updateRecordingUI","stopRecording","recording","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","_messages","require","_audio","_webrtc","_ui","constructor","ChatApp","WS_URL","reconnectAttempts","maxReconnectAttempts","webrtc","init","getUsername","setupEventListeners","prompt","random","backgroundColor","registerUser","refreshLists","connectWebSocket","_registerUser","onopen","updateConnectionStatus","onmessage","handleWebSocketMessage","onclose","attemptReconnect","onerror","handleNewMessage","handleCallOffer","handleCallAnswer","handleRemoteIceCandidate","handleCallRejected","handleCallEnded","handleCallFailed","sendMessage","sendVoiceNote","startCall","_createGroup","_callee5","groupInput","_context5","addGroupToList","removeGroupFromList","loadHistory","_callee6","_context6","_refreshLists","_callee7","_context7","_loadGroups","_callee8","_context8","updateGroupList","_loadUsers","_callee9","_context9","updateUserList","addEventListener","get","window","onload","createGroup","_chatApp"],"ignoreList":[],"sourceRoot":""}